#!/usr/bin/env ruby

require "smart_machine"

command = ARGV.shift

machine = SmartMachine::Machine.new
command = "" unless machine.local? || machine.remote?

case command
when "new"
	machine.create ARGV

when "credentials:edit"
	credentials = SmartMachine::Credentials.new
	credentials.edit

when "environment:edit"
	system("#{ENV['EDITOR']} config/environment.rb")

when "users:edit"
	system("#{ENV['EDITOR']} config/users.yml")

when "ssh"
	machine.ssh

when "install"
	machine.install

when "update"
	machine.update

when "uninstall"
	machine.uninstall

when "grids"
	machine.grids ARGV

when "apps"
	machine.apps ARGV

when "ps"
	machine.ps ARGV

when "logs"
	machine.logs ARGV

when "sync"
	sync = SmartMachine::Sync.new
	sync.run

when "--version"
	puts "SmartMachine #{SmartMachine.version}"

when "buildpacker"
	action = ARGV.shift
	buildpacker = SmartMachine::Buildpacker.new
	buildpacker.public_send(action, *ARGV)

when "prereceiver"
	action = ARGV.shift
	prereceiver = SmartMachine::Grids::Prereceiver.new
	prereceiver.public_send(action, *ARGV)

else
	puts "Specify a valid smartmachine command to execute. Are you in the correct directory to run this command?"

end
